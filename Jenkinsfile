pipeline {     agent any      environment {         DOCKER_IMAGE = 'my-k8s-webapp'         DOCKER_TAG = "${BUILD_NUMBER}"         KUBECONFIG = credentials('kubeconfig')     }      stages {         stage('Checkout') {             steps {                 echo 'Cloning repository...'                 checkout scm             }         }          stage('Build Docker Image') {             steps {                 echo 'Building Docker image...'                 dir('webapp') {                     script {                         sh "docker build -t ${DOCKER_IMAGE}:${DOCKER_TAG} ."                         sh "docker tag ${DOCKER_IMAGE}:${DOCKER_TAG} ${DOCKER_IMAGE}:latest"                     }                 }             }         }          stage('Code Quality Analysis') {             steps {                 echo 'Running SonarQube analysis...'                 script {                     // Pour l'instant on skip, on configurera plus tard                     echo 'SonarQube analysis skipped for now'                 }             }         }          stage('Deploy to Kubernetes') {             steps {                 echo 'Deploying to Kubernetes...'                 script {                     sh 'kubectl apply -f manifests/'                     sh "kubectl set image deployment/webapp webapp=${DOCKER_IMAGE}:${DOCKER_TAG} --record"                 }             }         }          stage('Verify Deployment') {             steps {                 echo 'Verifying deployment...'                 script {                     sh 'kubectl rollout status deployment/webapp'                     sh 'kubectl get pods'                     sh 'kubectl get services'                 }             }         }     }      post {         success {             echo 'Pipeline completed successfully!'         }         failure {             echo 'Pipeline failed!'         }         always {             echo 'Cleaning up...'             sh 'docker system prune -f'         }     } }
